// https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum ProdutoTipo {
  SERIE
  ANIME

  @@map("produto_tipo")
}

model Serie {
  id            Int      @id @default(autoincrement())
  titulo        String
  detalhes      String
  imagem        String
  estoque       Int
  valorUnitario Decimal  @map("valor_unitario")
  avaliacao     Decimal?
  votos         Int      @default(0)
  tipo          ProdutoTipo

  metaId        Int      @map("meta_id")
  meta          SerieMeta @relation(fields: [metaId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([tipo])
  @@map("series")
}


model SerieMeta {
  id         Int    @id @default(autoincrement())
  temporada String
  tema      String

  series    Serie[]

  @@index([tema])
  @@index([temporada])
  @@map("serie_meta")
}


model Carrinho {
  id        Int     @id @default(autoincrement())

  sessionId String? @unique @map("session_id")

  ownerId  String? @map("owner_id")
  // ID do usu√°rio vindo do provedor externo (Supabase, Clerk, etc)

  items     CarrinhoItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([ownerId])
  @@map("carrinho")
}



model CarrinhoItem {
  id          Int @id @default(autoincrement())

  carrinhoId Int @map("carrinho_id")
  carrinho   Carrinho @relation(fields: [carrinhoId], references: [id], onDelete: Cascade)

  produtoId  Int @map("produto_id")
  tipo       ProdutoTipo
  quantidade Int

  createdAt  DateTime @map("created_at")
  updatedAt  DateTime @map("updated_at")

  @@unique([carrinhoId, produtoId, tipo])
  @@map("carrinho_item")
}

enum UserRole {
  USUARIO
  ADMIN
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  firstName String   @map("first_name")
  lastName  String   @map("last_name")
  Cpf       String
  telefone  String
  cep       String
  genero    String
  nascimento String
  roles     UserRole[]   @default([USUARIO])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("app_users")
}


